namespace Exploits::Camera::CameraMods
{
    class CameraMod
    {
    public:

        static void Update()
        {
            uintptr_t cameraManager = read<uintptr_t>(Cache::PlayerController + _UnrealGlobals.PlayerCameraManager);
            if (!cameraManager) return;

            float targetFOV   = CFG::Exploits::fov_changer ? CFG::Exploits::updated_fov : CFG::Exploits::originalFOV;
            float currentFOV  = read<float>(cameraManager + FOV_Offset);

            if (IsValidOffset("APlayerCameraManager.DefaultFOV"))
                ApplyFOV(cameraManager, targetFOV, currentFOV);
        }

    private:

        static inline uintptr_t FOV_Offset = 0x3BC;

        static bool IsValidOffset(const char* name)
        {
            return SDK->find(name);
        }

        static void ApplyFOV(uintptr_t base, float desired, float current)
        {
            if (current == desired) return;

            try { write<float>(base + FOV_Offset, desired); }
            catch (...) {}
        }
    };
}
