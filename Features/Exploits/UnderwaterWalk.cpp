namespace Exploits::Movement::MovementMods
{
    class UnderwaterWalkMod
    {
    public:

        static void Update()
        {
            if (!CFG::Exploits::underwaterwalk)
                return;

            uintptr_t movementComp = read<uintptr_t>(Cache::AcknowledgedPawn + MovementCompOffset);
            if (!movementComp) return;

            uintptr_t swimParamsAddr = movementComp + SwimParamsOffset;
            auto swimParams = read<FAthenaCharacterSwimParams>(swimParamsAddr);

            Apply(swimParams);
            write<FAthenaCharacterSwimParams>(swimParamsAddr, swimParams);
        }

    private:

        static inline uintptr_t MovementCompOffset = 0x708;
        static inline uintptr_t SwimParamsOffset   = 0x590;

        static void Apply(FAthenaCharacterSwimParams& params)
        {
            if (KeyHeld())
            {
                params.EnterSwimmingDepth = 9999.f;
                params.ExitSwimmingDepth  = 9999.f;
            }
            else
            {
                params.EnterSwimmingDepth = 125.f;
                params.ExitSwimmingDepth  = 125.f;
            }
        }

        static bool KeyHeld()
        {
            return (GetAsyncKeyState('C') & 0x8000);
        }
    };
}
